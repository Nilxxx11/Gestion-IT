<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Gestión de Activos y Usuarios</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
    :root {
        --bg-primary: #121212;
        --bg-secondary: #1e1e1e;
        --text-primary: #e0e0e0;
        --text-secondary: #a0a0a0;
        --accent: #3a7bd5;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --info: #17a2b8;
    }
    body {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .sidebar {
        background-color: var(--bg-secondary);
        min-height: 100vh;
        padding: 0;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
    }
    .sidebar .nav-link {
        color: var(--text-secondary);
        padding: 15px 20px;
        transition: all 0.3s;
    }
    .sidebar .nav-link:hover, .sidebar .nav-link.active {
        color: var(--text-primary);
        background-color: rgba(58, 123, 213, 0.2);
        border-left: 4px solid var(--accent);
    }
    .sidebar .nav-link i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
    }
    .main-content {
        padding: 20px;
    }
    .card {
        background-color: var(--bg-secondary);
        border: none;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    .card-header {
        background: linear-gradient(45deg, rgba(58, 123, 213, 0.3), rgba(58, 123, 213, 0.1));
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-weight: 600;
        color: #e0e0e0;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        padding: 12px 20px;
        font-size: 1.1rem;
    }
    .card-header:has(+ .card-body #companyChart) {
        background: linear-gradient(45deg, rgba(86, 192, 224, 0.3), rgba(86, 192, 224, 0.1));
        color: #a0e7ff;
        border-left: 3px solid #56c0e0;
    }
    .card-header:has(+ .card-body #recentMaintenance) {
        background: linear-gradient(45deg, rgba(255, 193, 7, 0.3), rgba(255, 193, 7, 0.1));
        color: #ffdf82;
        border-left: 3px solid #ffc107;
    }
    .table {
        color: var(--text-primary);
    }
    .table thead th {
        background-color: rgba(0, 0, 0, 0.2);
        color: #e0e0e0;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        font-weight: 600;
    }
    .form-control, .form-select {
        background-color: #2c2c2c;
        border: 1px solid #444;
        color: var(--text-primary);
    }
    .form-control:focus, .form-select:focus {
        background-color: #2c2c2c;
        border-color: var(--accent);
        color: var(--text-primary);
        box-shadow: 0 0 0 0.25rem rgba(58, 123, 213, 0.25);
    }
    .btn-primary {
        background-color: var(--accent);
        border: none;
    }
    .btn-primary:hover {
        background-color: #2d63b0;
    }
    .stat-card {
        text-align: center;
        padding: 20px;
    }
    .stat-card i {
        font-size: 2rem;
        margin-bottom: 10px;
        color: var(--accent);
    }
    .stat-card .number {
        font-size: 1.8rem;
        font-weight: bold;
    }
    .stat-card .label {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    #userCount { color: var(--success); }
    #assetCount { color: var(--info); }
    #solutionCount { color: var(--warning); }
    #maintenanceCount { color: var(--danger); }
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: var(--bg-primary);
    }
    .login-box {
        background-color: var(--bg-secondary);
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 400px;
    }
    @media (max-width: 768px) {
        .sidebar {
            min-height: auto;
            margin-bottom: 20px;
        }
    }
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    .spinner-border {
        width: 3rem;
        height: 3rem;
    }
    .bg-success { background-color: var(--success) !important; }
    .bg-warning { background-color: var(--warning) !important; }
    .bg-danger { background-color: var(--danger) !important; }
    .bg-secondary { background-color: #6c757d !important; }
    .modal-content {
        background-color: var(--bg-secondary);
    }
    .modal-header, .modal-footer {
        border-color: #444;
    }
    .btn-outline-warning {
        color: var(--warning);
        border-color: var(--warning);
    }
    .btn-outline-warning:hover {
        background-color: var(--warning);
        color: #000;
    }
    .btn-outline-danger {
        color: var(--danger);
        border-color: var(--danger);
    }
    .btn-outline-danger:hover {
        background-color: var(--danger);
        color: #fff;
    }
    .btn-outline-info {
        color: var(--info);
        border-color: var(--info);
    }
    .btn-outline-info:hover {
        background-color: var(--info);
        color: #fff;
    }
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
    }
    ::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
</head>
<body>

<!-- Toast y loading -->
<div class="toast-container"></div>
<div class="loading-overlay d-none" id="loadingOverlay">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
</div>

<!-- Login -->
<div class="login-container" id="loginScreen">
    <div class="login-box">
        <h2 class="text-center mb-4">NilSystem</h2>
        <div class="mb-3">
            <label class="form-label" for="masterPassword">Contraseña Maestra</label>
            <input class="form-control" id="masterPassword" type="password" required/>
        </div>
        <button class="btn btn-primary w-100" id="loginBtn">Ingresar</button>
    </div>
</div>

<!-- App -->
<div class="d-none" id="appContent">
<div class="container-fluid">
<div class="row">
<!-- Sidebar -->
<div class="col-lg-2 col-md-3 sidebar py-4">
    <h4 class="text-center mb-4">NilSystem</h4>
    <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#usuarios"><i class="fas fa-users"></i> Usuarios</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#activos"><i class="fas fa-laptop"></i> Activos</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#soluciones"><i class="fas fa-tools"></i> Soluciones</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#mantenimientos"><i class="fas fa-cogs"></i> Mantenimientos</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#contrasenas"><i class="fas fa-key"></i> Contraseñas</a></li>
        <li class="nav-item mt-4">
            <a class="nav-link" href="#" id="exportBtn"><i class="fas fa-file-export"></i> Exportar a Excel</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" id="importBtn"><i class="fas fa-file-import"></i> Importar desde Excel</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
        </li>
    </ul>
</div>

<!-- Main Content -->
<div class="col-lg-10 col-md-9 main-content">
<div class="tab-content">

<!-- Dashboard -->
<div class="tab-pane fade show active" id="dashboard">
    <h2 class="mb-4">Dashboard</h2>
    <div class="row">
        <div class="col-md-3"><div class="card stat-card"><i class="fas fa-users"></i><div class="number" id="userCount">0</div><div class="label">Usuarios</div></div></div>
        <div class="col-md-3"><div class="card stat-card"><i class="fas fa-laptop"></i><div class="number" id="assetCount">0</div><div class="label">Activos</div></div></div>
        <div class="col-md-3"><div class="card stat-card"><i class="fas fa-tools"></i><div class="number" id="solutionCount">0</div><div class="label">Soluciones</div></div></div>
        <div class="col-md-3"><div class="card stat-card"><i class="fas fa-cogs"></i><div class="number" id="maintenanceCount">0</div><div class="label">Mantenimientos</div></div></div>
    </div>
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card"><div class="card-header">Activos por Empresa</div><div class="card-body"><canvas height="250" id="companyChart"></canvas></div></div>
        </div>
        <div class="col-md-6">
            <div class="card"><div class="card-header">Últimos Mantenimientos</div><div class="card-body"><div class="table-responsive"><table class="table table-sm"><thead><tr><th>Activo</th><th>Fecha</th><th>Tipo</th></tr></thead><tbody id="recentMaintenance"></tbody></table></div></div></div>
        </div>
    </div>
</div>

<!-- Activos -->
<div class="tab-pane fade" id="activos">
    <h2 class="mb-4">Gestión de Activos</h2>
    <div class="card">
        <div class="card-header">
            <button class="btn btn-primary btn-sm" data-bs-target="#assetModal" data-bs-toggle="modal"><i class="fas fa-plus"></i> Nuevo Activo</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Serial</th>
                            <th>Empresa</th>
                            <th>Tipo</th>
                            <th>Usuario</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="assetsTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Resto de secciones -->
<div class="tab-pane fade" id="usuarios">
    <h2 class="mb-4">Gestión de Usuarios</h2>
    <div class="card">
        <div class="card-header">
            <button class="btn btn-primary btn-sm" data-bs-target="#userModal" data-bs-toggle="modal"><i class="fas fa-plus"></i> Nuevo Usuario</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Empresa</th>
                            <th>Cargo</th>
                            <th>Email</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="tab-pane fade" id="soluciones">
    <h2 class="mb-4">Soluciones a Problemas</h2>
    <div class="card">
        <div class="card-header">
            <button class="btn btn-primary btn-sm" data-bs-target="#solutionModal" data-bs-toggle="modal"><i class="fas fa-plus"></i> Nueva Solución</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <div style="margin: 10px 0;"><label>Buscar en Soluciones:</label><input onkeyup="filtrarTabla('tabla_soluciones', this.value)" placeholder="Buscar..." style="margin-left: 10px; padding: 5px; border-radius: 5px; border: 1px solid var(--accent); background-color: var(--bg-secondary); color: var(--text-primary);" type="text"/></div>
                <table class="table table-striped table-hover" id="tabla_soluciones">
                    <thead>
                        <tr>
                            <th>Problema</th>
                            <th>Empresa</th>
                            <th>Categoría</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="solutionsTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="tab-pane fade" id="mantenimientos">
    <h2 class="mb-4">Registro de Mantenimientos</h2>
    <div class="card">
        <div class="card-header">
            <button class="btn btn-primary btn-sm" data-bs-target="#maintenanceModal" data-bs-toggle="modal"><i class="fas fa-plus"></i> Nuevo Mantenimiento</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Activo</th>
                            <th>Empresa</th>
                            <th>Tipo</th>
                            <th>Fecha</th>
                            <th>Descripción</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="maintenanceTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="tab-pane fade" id="contrasenas">
    <h2 class="mb-4">Gestión de Contraseñas</h2>
    <div class="card">
        <div class="card-header">
            <button class="btn btn-primary btn-sm" data-bs-target="#passwordModal" data-bs-toggle="modal"><i class="fas fa-plus"></i> Nueva Contraseña</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <div style="margin: 10px 0;"><label>Buscar en Contraseñas:</label><input onkeyup="filtrarTabla('tabla_contraseñas', this.value)" placeholder="Buscar..." style="margin-left: 10px; padding: 5px; border-radius: 5px; border: 1px solid var(--accent); background-color: var(--bg-secondary); color: var(--text-primary);" type="text"/></div>
                <table class="table table-striped table-hover" id="tabla_contraseñas">
                    <thead>
                        <tr>
                            <th>Sistema/App</th>
                            <th>Empresa</th>
                            <th>Usuario</th>
                            <th>Contraseña</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="passwordsTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

</div>
</div>
</div>
</div>

<!-- Modal de Activo (con Serial) -->
<div aria-hidden="true" class="modal fade" id="assetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="assetModalTitle">Agregar Activo</h5>
                <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form id="assetForm">
                    <input id="assetId" type="hidden"/>
                    <div class="mb-3">
                        <label class="form-label" for="assetName">Nombre</label>
                        <input class="form-control" id="assetName" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="assetSerial">Serial</label>
                        <input class="form-control" id="assetSerial" type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="assetCompany">Empresa</label>
                        <select class="form-select" id="assetCompany" required>
                            <option value="">Seleccionar...</option>
                            <option value="HB Y CIA S.A.S">HB Y CIA S.A.S</option>
                            <option value="Vehidiesel">Vehidiesel</option>
                            <option value="Vehimotors">Vehimotors</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="assetType">Tipo</label>
                        <select class="form-select" id="assetType" required>
                            <option value="">Seleccionar...</option>
                            <option value="PC">PC</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Impresora">Impresora</option>
                            <option value="Servidor">Servidor</option>
                            <option value="Hardware">Hardware</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="assetUser">Usuario Asignado</label>
                        <select class="form-select" id="assetUser">
                            <option value="">Ninguno</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="assetStatus">Estado</label>
                        <select class="form-select" id="assetStatus" required>
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                            <option value="Mantenimiento">En Mantenimiento</option>
                            <option value="Baja">De Baja</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="assetSpecs">Especificaciones</label>
                        <textarea class="form-control" id="assetSpecs" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" id="saveAsset">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Mantenimiento (sin costo) -->
<div aria-hidden="true" class="modal fade" id="maintenanceModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="maintenanceModalTitle">Agregar Mantenimiento</h5>
                <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form id="maintenanceForm">
                    <input id="maintenanceId" type="hidden"/>
                    <div class="mb-3">
                        <label class="form-label" for="maintenanceAsset">Activo</label>
                        <select class="form-select" id="maintenanceAsset" required>
                            <option value="">Seleccionar...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="maintenanceCompany">Empresa</label>
                        <select class="form-select" id="maintenanceCompany" required>
                            <option value="">Seleccionar...</option>
                            <option value="HB Y CIA S.A.S">HB Y CIA S.A.S</option>
                            <option value="Vehidiesel">Vehidiesel</option>
                            <option value="Vehimotors">Vehimotors</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="maintenanceType">Tipo de Mantenimiento</label>
                        <select class="form-select" id="maintenanceType" required>
                            <option value="">Seleccionar...</option>
                            <option value="Preventivo">Preventivo</option>
                            <option value="Correctivo">Correctivo</option>
                            <option value="Predictivo">Predictivo</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="maintenanceDate">Fecha</label>
                        <input class="form-control" id="maintenanceDate" required type="date"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="maintenanceDescription">Descripción</label>
                        <textarea class="form-control" id="maintenanceDescription" required rows="3"></textarea>
                    </div>
                    <!-- Campo de costo ELIMINADO -->
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" id="saveMaintenance">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Otros modales (usuario, solución, contraseña) -->
<div aria-hidden="true" class="modal fade" id="userModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalTitle">Agregar Usuario</h5>
                <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input id="userId" type="hidden"/>
                    <div class="mb-3">
                        <label class="form-label" for="userName">Nombre</label>
                        <input class="form-control" id="userName" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="userCompany">Empresa</label>
                        <select class="form-select" id="userCompany" required>
                            <option value="">Seleccionar...</option>
                            <option value="HB Y CIA S.A.S">HB Y CIA S.A.S</option>
                            <option value="Vehidiesel">Vehidiesel</option>
                            <option value="Vehimotors">Vehimotors</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="userPosition">Cargo</label>
                        <input class="form-control" id="userPosition" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="userEmail">Email</label>
                        <input class="form-control" id="userEmail" required type="email"/>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" id="saveUser">Guardar</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="solutionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="solutionModalTitle">Agregar Solución</h5>
                <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form id="solutionForm">
                    <input id="solutionId" type="hidden"/>
                    <div class="mb-3">
                        <label class="form-label" for="solutionProblem">Problema</label>
                        <input class="form-control" id="solutionProblem" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="solutionCompany">Empresa</label>
                        <select class="form-select" id="solutionCompany" required>
                            <option value="">Seleccionar...</option>
                            <option value="HB Y CIA S.A.S">HB Y CIA S.A.S</option>
                            <option value="Vehidiesel">Vehidiesel</option>
                            <option value="Vehimotors">Vehimotors</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="solutionCategory">Categoría</label>
                        <input class="form-control" id="solutionCategory" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="solutionDescription">Solución</label>
                        <textarea class="form-control" id="solutionDescription" required rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" id="saveSolution">Guardar</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="passwordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="passwordModalTitle">Agregar Contraseña</h5>
                <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <input id="passwordId" type="hidden"/>
                    <div class="mb-3">
                        <label class="form-label" for="passwordSystem">Sistema/Aplicación</label>
                        <input class="form-control" id="passwordSystem" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="passwordCompany">Empresa</label>
                        <select class="form-select" id="passwordCompany" required>
                            <option value="">Seleccionar...</option>
                            <option value="HB Y CIA S.A.S">HB Y CIA S.A.S</option>
                            <option value="Vehidiesel">Vehidiesel</option>
                            <option value="Vehimotors">Vehimotors</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="passwordUsername">Usuario</label>
                        <input class="form-control" id="passwordUsername" required type="text"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="passwordValue">Contraseña</label>
                        <div class="input-group">
                            <input class="form-control" id="passwordValue" required type="password"/>
                            <button class="btn btn-outline-secondary" id="togglePassword" type="button"><i class="fas fa-eye"></i></button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="passwordUrl">URL (opcional)</label>
                        <input class="form-control" id="passwordUrl" type="url"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="passwordNotes">Notas</label>
                        <textarea class="form-control" id="passwordNotes" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" id="savePassword">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Input oculto para importar Excel -->
<input type="file" id="importFile" accept=".xlsx, .xls" style="display:none;" />

<script>
// === FUNCIONES AUXILIARES ===
function filtrarTabla(idTabla, texto) {
    const tabla = document.getElementById(idTabla);
    const filas = tabla.getElementsByTagName("tr");
    texto = texto.toLowerCase();
    for (let i = 1; i < filas.length; i++) {
        let mostrar = false;
        const celdas = filas[i].getElementsByTagName("td");
        for (let j = 0; j < celdas.length; j++) {
            if (celdas[j].innerText.toLowerCase().includes(texto)) {
                mostrar = true;
                break;
            }
        }
        filas[i].style.display = mostrar ? "" : "none";
    }
}

function showToast(msg, type = 'success') {
    const container = document.querySelector('.toast-container');
    const id = 'toast-' + Date.now();
    const el = document.createElement('div');
    el.className = `toast align-items-center text-bg-${type} border-0`;
    el.setAttribute('role', 'alert');
    el.setAttribute('aria-live', 'assertive');
    el.setAttribute('aria-atomic', 'true');
    el.id = id;
    el.innerHTML = `<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
    container.appendChild(el);
    const toast = new bootstrap.Toast(el, { delay: 3000 });
    toast.show();
    el.addEventListener('hidden.bs.toast', () => el.remove());
}

function showLoading() { document.getElementById('loadingOverlay').classList.remove('d-none'); }
function hideLoading() { document.getElementById('loadingOverlay').classList.add('d-none'); }

function getStatusBadgeClass(status) {
    switch (status) {
        case 'Activo': return 'bg-success';
        case 'Inactivo': return 'bg-secondary';
        case 'Mantenimiento': return 'bg-warning';
        case 'Baja': return 'bg-danger';
        default: return 'bg-secondary';
    }
}

function formatDateForInput(timestamp) {
    if (!timestamp) return '';
    const d = new Date(timestamp);
    return d.toISOString().split('T')[0];
}

// === CONFIGURACIÓN DE FIREBASE ===
const firebaseConfig = {
    apiKey: "AIzaSyCfJiBkzwaLdoSpQDHU3rCgfC4nMr58hUk",
    authDomain: "paginaweb-d1886.firebaseapp.com",
    databaseURL: "https://paginaweb-d1886-default-rtdb.firebaseio.com",
    projectId: "paginaweb-d1886",
    storageBucket: "paginaweb-d1886.firebasestorage.app",
    messagingSenderId: "430619803153",
    appId: "1:430619803153:web:1fbada3c7fb6ca45a07bb0",
    measurementId: "G-BYJ5RVSZ92"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const usersRef = database.ref('users');
const assetsRef = database.ref('assets');
const solutionsRef = database.ref('solutions');
const maintenanceRef = database.ref('maintenance');
const passwordsRef = database.ref('passwords');
const configRef = database.ref('config');

let users = [];
let assets = [];
let solutions = [];
let maintenance = [];
let passwords = [];
let masterPassword = "&An&7538$$";

// === LOGIN (CORREGIDO) ===
function login() {
    const pwd = document.getElementById('masterPassword').value;
    if (pwd === masterPassword) {
        document.getElementById('loginScreen').classList.add('d-none');
        document.getElementById('appContent').classList.remove('d-none');
        showToast('Bienvenido a NilSystem', 'success');

        // Asignar listeners después del login
        document.getElementById('saveUser').addEventListener('click', saveUser);
        document.getElementById('saveAsset').addEventListener('click', saveAsset);
        document.getElementById('saveSolution').addEventListener('click', saveSolution);
        document.getElementById('saveMaintenance').addEventListener('click', saveMaintenance);
        document.getElementById('savePassword').addEventListener('click', savePassword);
        document.getElementById('togglePassword').addEventListener('click', togglePasswordVisibilityUI);
        document.getElementById('exportBtn').addEventListener('click', exportToExcel);
        document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importFile').click());
        document.getElementById('logoutBtn').addEventListener('click', logout);

        loadData();
    } else {
        showToast('Contraseña incorrecta', 'danger');
    }
}

function logout() {
    document.getElementById('loginScreen').classList.remove('d-none');
    document.getElementById('appContent').classList.add('d-none');
    document.getElementById('masterPassword').value = '';
    showToast('Sesión cerrada', 'info');
}

// === CARGA DE DATOS ===
function loadData() {
    usersRef.on('value', snapshot => {
        users = []; snapshot.forEach(child => { const u = child.val(); u.id = child.key; users.push(u); });
        renderUsers(); updateDashboard();
        const sel = document.getElementById('assetUser');
        sel.innerHTML = '<option value="">Ninguno</option>';
        users.forEach(u => {
            const opt = document.createElement('option');
            opt.value = u.id; opt.textContent = u.name;
            sel.appendChild(opt);
        });
    });
    assetsRef.on('value', snapshot => {
        assets = []; snapshot.forEach(child => { const a = child.val(); a.id = child.key; assets.push(a); });
        renderAssets(); updateDashboard();
        const sel = document.getElementById('maintenanceAsset');
        sel.innerHTML = '<option value="">Seleccionar...</option>';
        assets.forEach(a => {
            const opt = document.createElement('option');
            opt.value = a.id; opt.textContent = a.name;
            sel.appendChild(opt);
        });
    });
    solutionsRef.on('value', snapshot => { solutions = []; snapshot.forEach(child => { const s = child.val(); s.id = child.key; solutions.push(s); }); renderSolutions(); updateDashboard(); });
    maintenanceRef.on('value', snapshot => { maintenance = []; snapshot.forEach(child => { const m = child.val(); m.id = child.key; maintenance.push(m); }); renderMaintenance(); updateDashboard(); });
    passwordsRef.on('value', snapshot => { passwords = []; snapshot.forEach(child => { const p = child.val(); p.id = child.key; passwords.push(p); }); renderPasswords(); });
}

// === RENDERIZADO ===
function renderAssets() {
    const table = document.getElementById('assetsTable');
    table.innerHTML = '';
    assets.forEach(asset => {
        const userName = asset.user ? (users.find(u => u.id === asset.user)?.name || 'No asignado') : 'No asignado';
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${asset.name}</td>
            <td>${asset.serial || '—'}</td>
            <td>${asset.company}</td>
            <td>${asset.type}</td>
            <td>${userName}</td>
            <td><span class="badge ${getStatusBadgeClass(asset.status)}">${asset.status}</span></td>
            <td>
                <button class="btn btn-sm btn-outline-warning me-1 edit-asset" data-id="${asset.id}"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger delete-asset" data-id="${asset.id}"><i class="fas fa-trash"></i></button>
            </td>
        `;
        table.appendChild(row);
    });
    document.querySelectorAll('.edit-asset').forEach(btn => btn.addEventListener('click', e => editAsset(e.target.closest('button').dataset.id)));
    document.querySelectorAll('.delete-asset').forEach(btn => btn.addEventListener('click', e => deleteAsset(e.target.closest('button').dataset.id)));
}

function renderMaintenance() {
    const table = document.getElementById('maintenanceTable');
    table.innerHTML = '';
    maintenance.forEach(m => {
        const assetName = m.asset ? (assets.find(a => a.id === m.asset)?.name || '—') : '—';
        const date = m.date ? new Date(m.date).toLocaleDateString() : '—';
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${assetName}</td>
            <td>${m.company}</td>
            <td>${m.type}</td>
            <td>${date}</td>
            <td>${m.description?.substring(0, 50) + (m.description?.length > 50 ? '...' : '')}</td>
            <td>
                <button class="btn btn-sm btn-outline-warning me-1 edit-maintenance" data-id="${m.id}"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger delete-maintenance" data-id="${m.id}"><i class="fas fa-trash"></i></button>
            </td>
        `;
        table.appendChild(row);
    });
    document.querySelectorAll('.edit-maintenance').forEach(btn => btn.addEventListener('click', e => editMaintenance(e.target.closest('button').dataset.id)));
    document.querySelectorAll('.delete-maintenance').forEach(btn => btn.addEventListener('click', e => deleteMaintenance(e.target.closest('button').dataset.id)));
}

// === GUARDAR ===
function saveAsset() {
    const id = document.getElementById('assetId').value;
    const data = {
        name: document.getElementById('assetName').value,
        serial: document.getElementById('assetSerial').value,
        company: document.getElementById('assetCompany').value,
        type: document.getElementById('assetType').value,
        user: document.getElementById('assetUser').value || null,
        status: document.getElementById('assetStatus').value,
        specifications: document.getElementById('assetSpecs').value,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };
    if (!id) data.createdAt = firebase.database.ServerValue.TIMESTAMP;
    saveToFirebase(assetsRef, id, data, 'Activo', 'assetModal');
}

function saveMaintenance() {
    const id = document.getElementById('maintenanceId').value;
    const data = {
        asset: document.getElementById('maintenanceAsset').value,
        company: document.getElementById('maintenanceCompany').value,
        type: document.getElementById('maintenanceType').value,
        date: document.getElementById('maintenanceDate').value,
        description: document.getElementById('maintenanceDescription').value,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };
    if (!id) data.createdAt = firebase.database.ServerValue.TIMESTAMP;
    saveToFirebase(maintenanceRef, id, data, 'Mantenimiento', 'maintenanceModal');
}

function saveToFirebase(ref, id, data, name, modalId) {
    showLoading();
    const promise = id ? ref.child(id).update(data) : ref.push(data);
    promise.then(() => {
        showToast(`${name} ${id ? 'actualizado' : 'creado'} correctamente`, 'success');
    }).catch(err => {
        showToast(`Error: ${err.message}`, 'danger');
    }).finally(() => {
        hideLoading();
        bootstrap.Modal.getInstance(document.getElementById(modalId)).hide();
        document.getElementById(modalId.replace('Modal', 'Form')).reset();
        document.getElementById(modalId.replace('Modal', 'Id')).value = '';
    });
}

// === IMPORTACIÓN EXCEL ===
document.getElementById('importFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(sheet);
        if (!confirm(`¿Importar ${jsonData.length} activos?`)) return;
        showLoading();
        let count = 0;
        jsonData.forEach(row => {
            assetsRef.push({
                name: row.Nombre || '',
                serial: row.Serial || '',
                company: row.Empresa || '',
                type: row.Tipo || '',
                status: row.Estado || 'Activo',
                specifications: row.Especificaciones || '',
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                count++;
                if (count === jsonData.length) {
                    hideLoading();
                    showToast('Importación completada', 'success');
                    document.getElementById('importFile').value = '';
                }
            });
        });
    };
    reader.readAsArrayBuffer(file);
});

// === EXPORTACIÓN (sin costo) ===
function exportToExcel() {
    const wb = XLSX.utils.book_new();
    const userSheet = XLSX.utils.json_to_sheet(users.map(u => ({ Nombre: u.name, Empresa: u.company, Cargo: u.position, Email: u.email })));
    const assetSheet = XLSX.utils.json_to_sheet(assets.map(a => ({
        Nombre: a.name,
        Serial: a.serial || '',
        Empresa: a.company,
        Tipo: a.type,
        Usuario: a.user ? (users.find(u => u.id === a.user)?.name || '') : '',
        Estado: a.status,
        Especificaciones: a.specifications || ''
    })));
    const solutionSheet = XLSX.utils.json_to_sheet(solutions.map(s => ({
        Problema: s.problem,
        Empresa: s.company,
        Categoría: s.category,
        Solución: s.description,
        Fecha: s.date ? new Date(s.date).toLocaleDateString() : ''
    })));
    const maintenanceSheet = XLSX.utils.json_to_sheet(maintenance.map(m => {
        const asset = m.asset ? assets.find(a => a.id === m.asset) : null;
        return {
            Activo: asset ? asset.name : '',
            Empresa: m.company,
            Tipo: m.type,
            Fecha: m.date ? new Date(m.date).toLocaleDateString() : '',
            Descripción: m.description
            // Sin "Costo"
        };
    }));
    const passwordSheet = XLSX.utils.json_to_sheet(passwords.map(p => ({
        Sistema: p.system,
        Empresa: p.company,
        Usuario: p.username,
        Contraseña: p.password,
        URL: p.url || '',
        Notas: p.notes || ''
    })));
    XLSX.utils.book_append_sheet(wb, userSheet, 'Usuarios');
    XLSX.utils.book_append_sheet(wb, assetSheet, 'Activos');
    XLSX.utils.book_append_sheet(wb, solutionSheet, 'Soluciones');
    XLSX.utils.book_append_sheet(wb, maintenanceSheet, 'Mantenimientos');
    XLSX.utils.book_append_sheet(wb, passwordSheet, 'Contraseñas');
    XLSX.writeFile(wb, 'gestion_activos_usuarios.xlsx');
    showToast('Exportado correctamente', 'success');
}

// === UTILIDADES (edit/delete para otros módulos) ===
// ... (funciones saveUser, renderUsers, editUser, deleteUser, etc.)
// Por brevedad, se omiten aquí, pero están en el archivo completo adjunto.

// === INICIALIZACIÓN ===
document.addEventListener('DOMContentLoaded', function() {
    loadConfig();
    document.getElementById('loginBtn').addEventListener('click', login);
    document.getElementById('masterPassword').addEventListener('keypress', e => { if (e.key === 'Enter') login(); });
});

function loadConfig() {
    configRef.once('value').then(snapshot => {
        const config = snapshot.val();
        if (config && config.masterPassword) masterPassword = config.masterPassword;
    });
}

// === FUNCIONES COMPLEMENTARIAS (usuarios, soluciones, contraseñas) ===
function renderUsers() {
    const t = document.getElementById('usersTable'); t.innerHTML = '';
    users.forEach(u => {
        const r = document.createElement('tr');
        r.innerHTML = `<td>${u.name}</td><td>${u.company}</td><td>${u.position}</td><td>${u.email}</td><td>
            <button class="btn btn-sm btn-outline-warning me-1 edit-user" data-id="${u.id}"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline-danger delete-user" data-id="${u.id}"><i class="fas fa-trash"></i></button>
        </td>`;
        t.appendChild(r);
    });
    document.querySelectorAll('.edit-user').forEach(b => b.addEventListener('click', e => editUser(e.target.closest('button').dataset.id)));
    document.querySelectorAll('.delete-user').forEach(b => b.addEventListener('click', e => deleteUser(e.target.closest('button').dataset.id)));
}
function saveUser() {
    const id = document.getElementById('userId').value;
    const data = {
        name: document.getElementById('userName').value,
        company: document.getElementById('userCompany').value,
        position: document.getElementById('userPosition').value,
        email: document.getElementById('userEmail').value,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };
    if (!id) data.createdAt = firebase.database.ServerValue.TIMESTAMP;
    saveToFirebase(usersRef, id, data, 'Usuario', 'userModal');
}
function editUser(id) {
    const u = users.find(x => x.id === id);
    if (!u) return;
    document.getElementById('userId').value = u.id;
    document.getElementById('userName').value = u.name;
    document.getElementById('userCompany').value = u.company;
    document.getElementById('userPosition').value = u.position;
    document.getElementById('userEmail').value = u.email;
    document.getElementById('userModalTitle').textContent = 'Editar Usuario';
    new bootstrap.Modal(document.getElementById('userModal')).show();
}
function deleteUser(id) {
    if (!confirm('¿Eliminar usuario?')) return;
    showLoading();
    usersRef.child(id).remove().then(() => showToast('Usuario eliminado', 'success')).catch(err => showToast('Error: ' + err.message, 'danger')).finally(hideLoading);
}

// Soluciones
function renderSolutions() {
    const t = document.getElementById('solutionsTable'); t.innerHTML = '';
    solutions.forEach(s => {
        const d = s.date ? new Date(s.date).toLocaleDateString() : 'N/A';
        const r = document.createElement('tr');
        r.innerHTML = `<td>${s.problem}</td><td>${s.company}</td><td>${s.category}</td><td>${d}</td><td>
            <button class="btn btn-sm btn-outline-info me-1 view-solution" data-id="${s.id}"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline-warning me-1 edit-solution" data-id="${s.id}"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline-danger delete-solution" data-id="${s.id}"><i class="fas fa-trash"></i></button>
        </td>`;
        t.appendChild(r);
    });
    document.querySelectorAll('.view-solution').forEach(b => b.addEventListener('click', e => viewSolution(e.target.closest('button').dataset.id)));
    document.querySelectorAll('.edit-solution').forEach(b => b.addEventListener('click', e => editSolution(e.target.closest('button').dataset.id)));
    document.querySelectorAll('.delete-solution').forEach(b => b.addEventListener('click', e => deleteSolution(e.target.closest('button').dataset.id)));
}
function saveSolution() {
    const id = document.getElementById('solutionId').value;
    const data = {
        problem: document.getElementById('solutionProblem').value,
        company: document.getElementById('solutionCompany').value,
        category: document.getElementById('solutionCategory').value,
        description: document.getElementById('solutionDescription').value,
        date: firebase.database.ServerValue.TIMESTAMP,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };
    if (!id) data.createdAt = firebase.database.ServerValue.TIMESTAMP;
    saveToFirebase(solutionsRef, id, data, 'Solución', 'solutionModal');
}
function editSolution(id) {
    const s = solutions.find(x => x.id === id);
    if (!s) return;
    document.getElementById('solutionId').value = s.id;
    document.getElementById('solutionProblem').value = s.problem;
    document.getElementById('solutionCompany').value = s.company;
    document.getElementById('solutionCategory').value = s.category;
    document.getElementById('solutionDescription').value = s.description;
    document.getElementById('solutionModalTitle').textContent = 'Editar Solución';
    new bootstrap.Modal(document.getElementById('solutionModal')).show();
}
function viewSolution(id) {
    const s = solutions.find(x => x.id === id);
    if (s) alert(`Solución para: ${s.problem}\n${s.description}`);
}
function deleteSolution(id) {
    if (!confirm('¿Eliminar solución?')) return;
    showLoading();
    solutionsRef.child(id).remove().then(() => showToast('Solución eliminada', 'success')).catch(err => showToast('Error: ' + err.message, 'danger')).finally(hideLoading);
}

// Contraseñas
function renderPasswords() {
    const t = document.getElementById('passwordsTable'); t.innerHTML = '';
    passwords.forEach(p => {
        const r = document.createElement('tr');
        r.innerHTML = `<td>${p.system}</td><td>${p.company}</td><td>${p.username}</td><td>
            <span class="password-text">••••••••</span>
            <button class="btn btn-sm btn-outline-secondary ms-2 show-password" data-id="${p.id}"><i class="fas fa-eye"></i></button>
        </td><td>
            <button class="btn btn-sm btn-outline-warning me-1 edit-password" data-id="${p.id}"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline-danger delete-password" data-id="${p.id}"><i class="fas fa-trash"></i></button>
        </td>`;
        t.appendChild(r);
    });
    document.querySelectorAll('.show-password').forEach(b => b.addEventListener('click', e => togglePasswordVisibility(e.target.closest('button').dataset.id, e.target.closest('button'))));
    document.querySelectorAll('.edit-password').forEach(b => b.addEventListener('click', e => editPassword(e.target.closest('button').dataset.id)));
    document.querySelectorAll('.delete-password').forEach(b => b.addEventListener('click', e => deletePassword(e.target.closest('button').dataset.id)));
}
function savePassword() {
    const id = document.getElementById('passwordId').value;
    const data = {
        system: document.getElementById('passwordSystem').value,
        company: document.getElementById('passwordCompany').value,
        username: document.getElementById('passwordUsername').value,
        password: document.getElementById('passwordValue').value,
        url: document.getElementById('passwordUrl').value || '',
        notes: document.getElementById('passwordNotes').value || '',
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };
    if (!id) data.createdAt = firebase.database.ServerValue.TIMESTAMP;
    saveToFirebase(passwordsRef, id, data, 'Contraseña', 'passwordModal');
}
function editPassword(id) {
    const p = passwords.find(x => x.id === id);
    if (!p) return;
    document.getElementById('passwordId').value = p.id;
    document.getElementById('passwordSystem').value = p.system;
    document.getElementById('passwordCompany').value = p.company;
    document.getElementById('passwordUsername').value = p.username;
    document.getElementById('passwordValue').value = p.password;
    document.getElementById('passwordUrl').value = p.url || '';
    document.getElementById('passwordNotes').value = p.notes || '';
    document.getElementById('passwordModalTitle').textContent = 'Editar Contraseña';
    new bootstrap.Modal(document.getElementById('passwordModal')).show();
}
function deletePassword(id) {
    if (!confirm('¿Eliminar contraseña?')) return;
    showLoading();
    passwordsRef.child(id).remove().then(() => showToast('Contraseña eliminada', 'success')).catch(err => showToast('Error: ' + err.message, 'danger')).finally(hideLoading);
}
function togglePasswordVisibility(id, btn) {
    const p = passwords.find(x => x.id === id);
    if (!p) return;
    const row = btn.closest('tr');
    const txt = row.querySelector('.password-text');
    if (txt.textContent === '••••••••') {
        txt.textContent = p.password;
        btn.innerHTML = '<i class="fas fa-eye-slash"></i>';
    } else {
        txt.textContent = '••••••••';
        btn.innerHTML = '<i class="fas fa-eye"></i>';
    }
}
function togglePasswordVisibilityUI() {
    const field = document.getElementById('passwordValue');
    const type = field.type === 'password' ? 'text' : 'password';
    field.type = type;
    document.getElementById('togglePassword').innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
}

// Dashboard
function updateDashboard() {
    document.getElementById('userCount').textContent = users.length;
    document.getElementById('assetCount').textContent = assets.length;
    document.getElementById('solutionCount').textContent = solutions.length;
    document.getElementById('maintenanceCount').textContent = maintenance.length;
    updateCompanyChart();
    updateRecentMaintenance();
}
function updateCompanyChart() {
    const counts = { 'HB Y CIA S.A.S': 0, 'Vehidiesel': 0, 'Vehimotors': 0 };
    assets.forEach(a => { if (counts.hasOwnProperty(a.company)) counts[a.company]++; });
    const ctx = document.getElementById('companyChart').getContext('2d');
    if (window.companyChartInstance) window.companyChartInstance.destroy();
    window.companyChartInstance = new Chart(ctx, {
        type: 'doughnut',
         {
            labels: Object.keys(counts),
            datasets: [{
                data: Object.values(counts),
                backgroundColor: ['rgba(58, 123, 213, 0.8)', 'rgba(40, 167, 69, 0.8)', 'rgba(255, 193, 7, 0.8)'],
                borderColor: ['rgba(58, 123, 213, 1)', 'rgba(40, 167, 69, 1)', 'rgba(255, 193, 7, 1)'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#e0e0e0' } }
            }
        }
    });
}
function updateRecentMaintenance() {
    const t = document.getElementById('recentMaintenance'); t.innerHTML = '';
    const sorted = [...maintenance].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
    sorted.forEach(m => {
        const assetName = m.asset ? (assets.find(a => a.id === m.asset)?.name || '—') : '—';
        const date = m.date ? new Date(m.date).toLocaleDateString() : '—';
        const r = document.createElement('tr');
        r.innerHTML = `<td>${assetName}</td><td>${date}</td><td>${m.type}</td>`;
        t.appendChild(r);
    });
}
</script>
</body>
</html>