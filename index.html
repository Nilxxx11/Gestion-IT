<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestor de Activos Empresarial</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --light-bg: #f9fafb;
      --card-bg: #ffffff;
      --border-color: #e5e7eb;
      --text-color: #1f2937;
      --text-light: #6b7280;
      --success: #10b981;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--light-bg);
      color: var(--text-color);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px 0;
    }

    .logo-container {
      margin-bottom: 16px;
    }

    .logo {
      height: 60px;
      max-width: 200px;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    header h1 {
      font-size: 2rem;
      font-weight: 600;
      color: var(--primary);
      margin: 12px 0 8px;
    }

    header p {
      color: var(--text-light);
      font-size: 1rem;
    }

    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .tab-btn {
      flex: 1;
      min-width: 120px;
      padding: 12px 16px;
      background: transparent;
      border: none;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tab-btn:hover {
      color: var(--primary);
    }

    .tab-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    }

    .tab-content {
      display: none;
      background: var(--card-bg);
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      padding: 28px;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--primary);
      font-weight: 600;
    }

    h3 {
      font-size: 1.25rem;
      margin: 24px 0 16px;
      color: var(--text-color);
    }

    .form-card {
      background: #f8fafc;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--text-color);
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }

    button[type="submit"] {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      width: auto;
    }

    button[type="submit"]:hover {
      background: var(--primary-dark);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    th {
      background-color: #f1f5f9;
      color: var(--primary);
      font-weight: 600;
      padding: 14px 16px;
      text-align: left;
      font-size: 0.95rem;
    }

    td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    td:hover {
      background-color: #f0f7ff;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:nth-child(even) {
      background-color: #fafcff;
    }

    tr:nth-child(even) td:hover {
      background-color: #f0f7ff;
    }

    .editable-input {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid var(--primary);
      border-radius: 4px;
      font-family: 'Inter', sans-serif;
      font-size: 0.95rem;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      border-radius: 14px;
      padding: 24px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      border: 1px solid #bfdbfe;
    }

    .stat-card h3 {
      font-size: 1rem;
      color: var(--text-light);
      margin-bottom: 10px;
      font-weight: 500;
    }

    .stat-card .value {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-card .icon {
      font-size: 2rem;
      margin-bottom: 12px;
      color: var(--primary);
    }

    .btn-secondary {
      background: white;
      color: var(--primary);
      border: 1px solid var(--primary);
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: #f0f9ff;
    }

    .import-export {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .tabs {
        flex-direction: column;
      }
      .tab-btn {
        min-width: auto;
        margin-bottom: 6px;
      }
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      .import-export {
        flex-direction: column;
        align-items: flex-start;
      }
      .logo {
        height: 50px;
      }
      header h1 {
        font-size: 1.7rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-container">
        <img id="app-logo" class="logo" alt="Logo de la empresa">
      </div>
      <h1>Gestor de Activos Empresarial</h1>
      <p>Control total de tus equipos, usuarios y mantenimientos</p>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="dashboard">ðŸ“Š Dashboard</button>
      <button class="tab-btn" data-tab="usuarios">ðŸ‘¥ Usuarios</button>
      <button class="tab-btn" data-tab="activos">ðŸ’» Activos</button>
      <button class="tab-btn" data-tab="mantenimientos">ðŸ”§ Mantenimientos</button>
      <button class="tab-btn" data-tab="importar">ðŸ“¤ Importar/Exportar</button>
    </div>

    <div id="dashboard" class="tab-content active">
      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="icon">ðŸ‘¥</div>
          <h3>Usuarios Registrados</h3>
          <div class="value" id="count-usuarios">0</div>
        </div>
        <div class="stat-card">
          <div class="icon">ðŸ’»</div>
          <h3>Activos en Sistema</h3>
          <div class="value" id="count-activos">0</div>
        </div>
        <div class="stat-card">
          <div class="icon">ðŸ”§</div>
          <h3>Mantenimientos Realizados</h3>
          <div class="value" id="count-mantenimientos">0</div>
        </div>
      </div>

      <h3>Ãšltimos 5 Mantenimientos</h3>
      <table id="tabla-ultimos-mantenimientos">
        <thead><tr><th>Equipo</th><th>Fecha</th><th>Tipo</th><th>Observaciones</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="usuarios" class="tab-content">
      <div class="form-card">
        <h2>Registrar Nuevo Usuario</h2>
        <form id="form-usuario">
          <div class="form-group"><label>Nombre Completo</label><input type="text" id="nombre-usuario" required /></div>
          <div class="form-group"><label>Correo ElectrÃ³nico</label><input type="email" id="email-usuario" required /></div>
          <button type="submit">Agregar Usuario</button>
        </form>
      </div>
      <h3>Lista de Usuarios</h3>
      <table id="tabla-usuarios"><thead><tr><th>Nombre</th><th>Correo</th><th>Fecha Registro</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="activos" class="tab-content">
      <div class="form-card">
        <h2>Registrar Nuevo Activo</h2>
        <form id="form-activo">
          <div class="form-group"><label>Nombre del Activo</label><input type="text" id="nombre-activo" required /></div>
          <div class="form-group"><label>Serial</label><input type="text" id="serial-activo" required /></div>
          <div class="form-group"><label>Empresa</label><input type="text" id="empresa-activo" required /></div>
          <div class="form-group"><label>Tipo</label><input type="text" id="tipo-activo" placeholder="Ej: Laptop, Impresora" required /></div>
          <div class="form-group"><label>Estado</label><select id="estado-activo" required><option value="">Seleccionar estado</option><option value="activo">Activo</option><option value="inactivo">Inactivo</option><option value="en_reparacion">En reparaciÃ³n</option></select></div>
          <div class="form-group"><label>Usuario Asignado</label><input type="text" id="usuario-asignado" placeholder="Nombre o email del usuario" /></div>
          <div class="form-group"><label>Especificaciones TÃ©cnicas</label><textarea id="especificaciones-activo" placeholder="Detalles tÃ©cnicos, modelo, etc."></textarea></div>
          <button type="submit">Registrar Activo</button>
        </form>
      </div>
      <h3>Inventario de Activos</h3>
      <table id="tabla-activos"><thead><tr><th>Nombre</th><th>Serial</th><th>Empresa</th><th>Tipo</th><th>Estado</th><th>Asignado a</th><th>Especificaciones</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="mantenimientos" class="tab-content">
      <div class="form-card">
        <h2>Registrar Mantenimiento</h2>
        <form id="form-mantenimiento">
          <div class="form-group"><label>Equipo (Nombre o Serial)</label><input type="text" id="equipo-mantenimiento" required /></div>
          <div class="form-group"><label>Fecha</label><input type="date" id="fecha-mantenimiento" required /></div>
          <div class="form-group"><label>Tipo de Mantenimiento</label><input type="text" id="tipo-mantenimiento" placeholder="Preventivo, Correctivo, etc." required /></div>
          <div class="form-group"><label>Observaciones</label><textarea id="observaciones-mantenimiento" placeholder="Detalles del mantenimiento realizado"></textarea></div>
          <button type="submit">Registrar Mantenimiento</button>
        </form>
      </div>
      <h3>Historial de Mantenimientos</h3>
      <table id="tabla-mantenimientos"><thead><tr><th>Equipo</th><th>Fecha</th><th>Tipo</th><th>Observaciones</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="importar" class="tab-content">
      <h2>Importar y Exportar Datos</h2>
      <p style="margin-bottom: 20px; color: var(--text-light);">Gestiona tus datos en formato JSON. Puedes convertirlo fÃ¡cilmente a Excel usando herramientas online.</p>
      <div class="import-export">
        <button class="btn-secondary" onclick="exportarDatos()">ðŸ“¥ Exportar a JSON</button>
        <input type="file" id="import-file" accept=".json" style="padding: 8px; border-radius: 8px; border: 1px solid var(--border-color);" />
        <button class="btn-secondary" onclick="importarDatos()">ðŸ“¤ Importar desde JSON</button>
      </div>
    </div>
  </div>

  <script>
    // ðŸ”§ CONFIGURACIÃ“N DEL LOGO
    const LOGO_URL = "logo.png"; // ðŸ‘ˆ Â¡CAMBIA ESTO!

    // ðŸ”¥ ConfiguraciÃ³n de Firebase (Â¡NO OLVIDES CAMBIARLA!)
    const firebaseConfig = {
        apiKey: "AIzaSyCfJiBkzwaLdoSpQDHU3rCgfC4nMr58hUk",
        authDomain: "paginaweb-d1886.firebaseapp.com",
        databaseURL: "https://paginaweb-d1886-default-rtdb.firebaseio.com",
        projectId: "paginaweb-d1886",
        storageBucket: "paginaweb-d1886.firebasestorage.app",
        messagingSenderId: "430619803153",
        appId: "1:430619803153:web:1fbada3c7fb6ca45a07bb0",
        measurementId: "G-BYJ5RVSZ92"
    };

    // --- Inicializar logo ---
    document.getElementById('app-logo').src = LOGO_URL;

    // --- Inicializar Firebase ---
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- NavegaciÃ³n por pestaÃ±as ---
    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        button.classList.add('active');
        const tabId = button.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });

    // --- Formularios ---
    document.getElementById('form-usuario').addEventListener('submit', e => {
      e.preventDefault();
      db.ref('usuarios').push({
        nombre: e.target['nombre-usuario'].value,
        email: e.target['email-usuario'].value,
        fecha_registro: new Date().toISOString()
      });
      e.target.reset();
      cargarUsuarios();
      cargarDashboard();
    });

    document.getElementById('form-activo').addEventListener('submit', e => {
      e.preventDefault();
      db.ref('activos').push({
        nombre: e.target['nombre-activo'].value,
        serial: e.target['serial-activo'].value,
        empresa: e.target['empresa-activo'].value,
        tipo: e.target['tipo-activo'].value,
        estado: e.target['estado-activo'].value,
        usuario_asignado: e.target['usuario-asignado'].value,
        especificaciones: e.target['especificaciones-activo'].value,
        fecha_registro: new Date().toISOString()
      });
      e.target.reset();
      cargarActivos();
      cargarDashboard();
    });

    document.getElementById('form-mantenimiento').addEventListener('submit', e => {
      e.preventDefault();
      db.ref('mantenimientos').push({
        equipo: e.target['equipo-mantenimiento'].value,
        fecha: e.target['fecha-mantenimiento'].value,
        tipo: e.target['tipo-mantenimiento'].value,
        observaciones: e.target['observaciones-mantenimiento'].value,
        fecha_registro: new Date().toISOString()
      });
      e.target.reset();
      cargarMantenimientos();
      cargarDashboard();
    });

    // --- EdiciÃ³n en tablas ---
    function makeEditable(tableId, fields, path) {
      const table = document.getElementById(tableId);
      table.addEventListener('click', (e) => {
        if (e.target.tagName === 'TD') {
          const row = e.target.closest('tr');
          const key = row.dataset.key;
          if (!key) return;

          const colIndex = Array.from(e.target.parentNode.children).indexOf(e.target);
          const field = fields[colIndex];
          if (!field) return;

          const currentValue = e.target.textContent.trim();
          if (currentValue === 'â€”') return;

          const input = document.createElement('input');
          input.type = field === 'fecha' ? 'date' : 'text';
          input.className = 'editable-input';
          input.value = field === 'fecha' ? currentValue : currentValue;
          e.target.innerHTML = '';
          e.target.appendChild(input);
          input.focus();

          const saveChanges = () => {
            const newValue = input.value.trim();
            if (newValue !== currentValue) {
              db.ref(`${path}/${key}`).update({ [field]: newValue }).then(() => {
                cargarAll(); // Recargar todo para mantener consistencia
              }).catch(err => {
                console.error("Error al guardar:", err);
                alert("Error al guardar el cambio.");
                cargarAll();
              });
            } else {
              cargarAll();
            }
          };

          input.addEventListener('blur', saveChanges);
          input.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter') {
              saveChanges();
            } else if (ev.key === 'Escape') {
              cargarAll();
            }
          });
        }
      });
    }

    // --- Carga de tablas ---
    function cargarUsuarios() {
      const tbody = document.querySelector('#tabla-usuarios tbody');
      tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">Cargando...</td></tr>';
      db.ref('usuarios').once('value').then(snapshot => {
        tbody.innerHTML = '';
        snapshot.forEach(child => {
          const u = child.val();
          const tr = document.createElement('tr');
          tr.dataset.key = child.key;
          tr.innerHTML = `<td>${u.nombre}</td><td>${u.email}</td><td>${new Date(u.fecha_registro).toLocaleDateString()}</td>`;
          tbody.appendChild(tr);
        });
        makeEditable('tabla-usuarios', ['nombre', 'email', null], 'usuarios');
      });
    }

    function cargarActivos() {
      const tbody = document.querySelector('#tabla-activos tbody');
      tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Cargando...</td></tr>';
      db.ref('activos').once('value').then(snapshot => {
        tbody.innerHTML = '';
        snapshot.forEach(child => {
          const a = child.val();
          const tr = document.createElement('tr');
          tr.dataset.key = child.key;
          tr.innerHTML = `
            <td>${a.nombre}</td>
            <td>${a.serial}</td>
            <td>${a.empresa}</td>
            <td>${a.tipo}</td>
            <td>${a.estado}</td>
            <td>${a.usuario_asignado || 'â€”'}</td>
            <td>${a.especificaciones?.substring(0, 50) || 'â€”'}</td>
          `;
          tbody.appendChild(tr);
        });
        makeEditable('tabla-activos', ['nombre', 'serial', 'empresa', 'tipo', 'estado', 'usuario_asignado', 'especificaciones'], 'activos');
      });
    }

    function cargarMantenimientos() {
      const tbody = document.querySelector('#tabla-mantenimientos tbody');
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 16px;">Cargando historial...</td></tr>';

      db.ref('mantenimientos').once('value').then(snapshot => {
        if (!snapshot.exists() || snapshot.numChildren() === 0) {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 16px;">No hay registros de mantenimiento.</td></tr>';
          return;
        }

        const mantenimientos = [];
        snapshot.forEach(child => {
          mantenimientos.push({ key: child.key, ...child.val() });
        });

        mantenimientos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        tbody.innerHTML = '';
        mantenimientos.forEach(m => {
          const tr = document.createElement('tr');
          tr.dataset.key = m.key;
          tr.innerHTML = `
            <td>${m.equipo || 'â€”'}</td>
            <td>${m.fecha || 'â€”'}</td>
            <td>${m.tipo || 'â€”'}</td>
            <td>${m.observaciones?.substring(0, 80) || 'â€”'}</td>
          `;
          tbody.appendChild(tr);
        });
        makeEditable('tabla-mantenimientos', ['equipo', 'fecha', 'tipo', 'observaciones'], 'mantenimientos');
      }).catch(err => {
        console.error("Error al cargar mantenimientos:", err);
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 16px; color: #e53e3e;">Error al cargar los datos.</td></tr>';
      });
    }

    function cargarDashboard() {
  // Contar usuarios
  db.ref('usuarios').once('value').then(s => {
    document.getElementById('count-usuarios').textContent = s.numChildren();
  });

  // Contar activos
  db.ref('activos').once('value').then(s => {
    document.getElementById('count-activos').textContent = s.numChildren();
  });

  // Contar mantenimientos Y mostrar Ãºltimos 5
  db.ref('mantenimientos').once('value').then(snapshot => {
    const count = snapshot.numChildren();
    document.getElementById('count-mantenimientos').textContent = count;

    if (count === 0) {
      document.querySelector('#tabla-ultimos-mantenimientos tbody').innerHTML = 
        '<tr><td colspan="4" style="text-align:center;">Sin mantenimientos</td></tr>';
      return;
    }

    // Convertir a array y ordenar por fecha (descendente)
    const mantenimientos = [];
    snapshot.forEach(child => {
      mantenimientos.push(child.val());
    });

    // Ordenar: mÃ¡s reciente primero
    mantenimientos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

    // Tomar los primeros 5 (los mÃ¡s recientes)
    const ultimos5 = mantenimientos.slice(0, 5);

    // Renderizar
    const tbody = document.querySelector('#tabla-ultimos-mantenimientos tbody');
    tbody.innerHTML = '';
    ultimos5.forEach(m => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${m.equipo || 'â€”'}</td>
        <td>${m.fecha || 'â€”'}</td>
        <td>${m.tipo || 'â€”'}</td>
        <td>${m.observaciones?.substring(0, 60) || 'â€”'}</td>
      `;
      tbody.appendChild(tr);
    });
  }).catch(err => {
    console.error("Error en dashboard:", err);
    document.querySelector('#tabla-ultimos-mantenimientos tbody').innerHTML = 
      '<tr><td colspan="4" style="text-align:center; color:red;">Error al cargar</td></tr>';
  });
}

    function cargarAll() {
      cargarDashboard();
      cargarUsuarios();
      cargarActivos();
      cargarMantenimientos();
    }

    // --- Importar/Exportar ---
    function exportarDatos() {
      const data = {};
      Promise.all([
        db.ref('usuarios').once('value').then(s => data.usuarios = s.val() || {}),
        db.ref('activos').once('value').then(s => data.activos = s.val() || {}),
        db.ref('mantenimientos').once('value').then(s => data.mantenimientos = s.val() || {})
      ]).then(() => {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'backup_activos.json';
        a.click();
        URL.revokeObjectURL(url);
      });
    }

    function importarDatos() {
      const file = document.getElementById('import-file').files[0];
      if (!file) return alert('Por favor, selecciona un archivo JSON.');
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.usuarios) Object.values(data.usuarios).forEach(u => db.ref('usuarios').push(u));
          if (data.activos) Object.values(data.activos).forEach(a => db.ref('activos').push(a));
          if (data.mantenimientos) Object.values(data.mantenimientos).forEach(m => db.ref('mantenimientos').push(m));
          alert('âœ… Datos importados correctamente.');
          cargarAll();
        } catch (err) {
          alert('âŒ Error al importar: ' + err.message);
        }
      };
      reader.readAsText(file);
    }

    // --- Inicializar ---
    window.onload = () => {
      cargarAll();
    };
  </script>
</body>
</html>